<div class="p-3 md:p-4">
  <!-- Encabezado -->
  <div class="grid align-items-center mb-3">
    <div class="col-12 md:col-4">
      <span class="text-500 font-bold text-sm">Nombre equipo local</span>
          <div class="flex gap-2 align-items-center">
             <input 
            pInputText 
            [(ngModel)]="teamName.home" 
            class="w-full font-bold uppercase"
            (ngModelChange)="teamName.home = $event.toUpperCase()" 
            />
                 <button pButton type="button" icon="pi pi-palette" class="p-button-text p-button-rounded"
          (click)="cpHome.toggle($event)"></button>

           <p-overlayPanel #cpHome appendTo="body" [showCloseIcon]="true" [dismissable]="true">
                <!-- Evita que los clics internos cierren el overlay por burbujeo -->
            <div>
                <p-colorPicker
                class="cpmini"
                [(ngModel)]="teamColor.home"
                format="hex"
                [inline]="true"
                (onChange)="onColorChange()">
                </p-colorPicker>

                <div class="flex justify-content-end gap-2 mt-2">
                <button pButton type="button" label="Listo" (click)="cpHome.hide()"></button>
                </div>
            </div>
            </p-overlayPanel>
        </div>
           
    </div>
    <div class="col-12 md:col-4 text-center">
      <div class="text-700 text-sm mb-1">Duraci√≥n del cuarto</div>
      <p-dropdown
        [options]="quarterOptions"
        [(ngModel)]="selectedDuration"
        (onChange)="onChangeDuration()"
        optionLabel="label" optionValue="value" class="w-12rem">
      </p-dropdown>
      <p-toggleButton
        class="ml-2"
        [(ngModel)]="autoAdvance"
        onLabel="Cuarto_Automatico"
        offLabel="Cuarto_Manual"
      ></p-toggleButton>
    </div>
    <div class="col-12 md:col-4">
      <span class="text-500 font-bold text-sm">Nombre equipo visitante</span>
       <div class="flex gap-2 align-items-center">
             <input 
            pInputText 
            [(ngModel)]="teamName.away" 
            class="w-full font-bold uppercase"
            (ngModelChange)="teamName.away = $event.toUpperCase()" 
            />
            <button pButton type="button" icon="pi pi-palette" class="p-button-text p-button-rounded"
                    (click)="cpAway.toggle($event)"></button>

          
           <p-overlayPanel #cpAway appendTo="body" [showCloseIcon]="true" [dismissable]="true">
                <!-- Evita que los clics internos cierren el overlay por burbujeo -->
            <div >
                <p-colorPicker
                class="cpmini"
                [(ngModel)]="teamColor.away"
                format="hex"
                [inline]="true"
                (onChange)="onColorChange()">
                </p-colorPicker>

                <div class="flex justify-content-end gap-2 mt-2">
                <button pButton type="button" label="Listo" (click)="cpAway.hide()"></button>
                </div>
            </div>
            </p-overlayPanel>
            </div>
    </div>
  </div>

  <!-- Reloj y cuarto -->
  <div class="grid mb-3">
    <div class="col-12">
      <p-card class="timer-card">
        <div class="flex flex-column align-items-center">
          <div class="timer-display">{{ fmt(remainingSec) }}</div>
          <div class="mt-2 text-600">Cuarto <span class="text-900 font-bold">Q{{ quarter }}</span> / {{ maxQuarters }}</div>
          <div class="mt-3 flex gap-2">
            <button pButton [icon]="timer.isRunning ? 'pi pi-pause' : 'pi pi-play'"
                    (click)="startPause()" label="{{ timer.isRunning ? 'Pausar' : 'Iniciar' }}"></button>
            <button pButton icon="pi pi-refresh" class="p-button-secondary" (click)="resetTimer()" label="Reiniciar reloj"></button>
            <button pButton icon="pi pi-forward" class="p-button-help" (click)="nextQuarter()"
                    label="Siguiente cuarto"></button>
          </div>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Paneles de equipos -->
  <div class="grid">
    <!-- Local -->
    <div class="col-12 md:col-6">
      <p-card [header]="teamName.home"  [style]="getTeamStyles('home')" class="team-card team-home" [subheader]="'Faltas: ' + fouls.home">
        <div class="score">{{ score.home }}</div>

        <div class="btn-row">
          <button pButton label="+1" (click)="addPoints('home', 1)"></button>
          <button pButton label="+2" class="p-button-success" (click)="addPoints('home', 2)"></button>
          <button pButton label="+3" class="p-button-warning" (click)="addPoints('home', 3)"></button>
          <button pButton icon="pi pi-undo" class="p-button-secondary" (click)="undoPoint('home')" label="-1"></button>
        </div>

        <p-divider></p-divider>

        <div class="btn-row">
          <button pButton icon="pi pi-user-plus" label="Falta +" (click)="addFoul('home')"></button>
          <button pButton icon="pi pi-user-minus" class="p-button-secondary" label="Falta -" (click)="undoFoul('home')"></button>
        </div>
      </p-card>
    </div>

    <!-- Visitante -->
    <div class="col-12 md:col-6">
      <p-card [header]="teamName.away" class="team-card team-away"  [style]="getTeamStyles('away')" [subheader]="'Faltas: ' + fouls.away">
        <div class="score">{{ score.away }}</div>

        <div class="btn-row">
          <button pButton label="+1" (click)="addPoints('away', 1)"></button>
          <button pButton label="+2" class="p-button-success" (click)="addPoints('away', 2)"></button>
          <button pButton label="+3" class="p-button-warning" (click)="addPoints('away', 3)"></button>
          <button pButton icon="pi pi-undo" class="p-button-secondary" (click)="undoPoint('away')" label="-1"></button>
        </div>

        <p-divider></p-divider>

        <div class="btn-row">
          <button pButton icon="pi pi-user-plus" label="Falta +" (click)="addFoul('away')"></button>
          <button pButton icon="pi pi-user-minus" class="p-button-secondary" label="Falta -" (click)="undoFoul('away')"></button>
        </div>
      </p-card>
    </div>
  </div>

  <!-- Acciones generales -->
  <div class="flex justify-content-between align-items-center mt-3">
        <small class="text-600 font-bold">Nota: al finalizar el cuarto suena un buzzer y aparece aviso.</small>
        <br>
    <button pButton icon="pi pi-refresh" class="p-button-danger" (click)="fullReset()" label="Reiniciar todo"></button>
  </div>
</div>
